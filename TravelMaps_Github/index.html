<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Didius Travel Map â€” Minimal Directions</title>

<!-- Mapbox GL core -->
<link href="https://api.mapbox.com/mapbox-gl-js/v3.13.0/mapbox-gl.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/v3.13.0/mapbox-gl.js"></script>

<!-- Directions plugin (official CDN) -->
<link href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.3.1/mapbox-gl-directions.css" rel="stylesheet">
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.3.1/mapbox-gl-directions.js"></script>

<style>
  html,body{height:100%;margin:0;font-family:system-ui,Inter,Arial}
  #map{height:100vh;width:100%}
  #err{position:absolute;left:12px;bottom:12px;background:#fff;border:1px solid #e5e7eb;border-radius:10px;
       padding:8px 10px;box-shadow:0 6px 20px rgba(0,0,0,.12);font-size:12px;max-width:60ch;display:none}
  .mapboxgl-ctrl-top-right{margin-top:8px}
</style>
</head>
<body>

<div id="map" aria-label="Interactive map"></div>
<div id="err"></div>

<script>
// === Credentials & constants ===
mapboxgl.accessToken = 'YOUR_NEW_TOKEN_HERE';  // <- replace with your updated token
const STYLE_URL   = 'mapbox://styles/brad13martin/cmkjztnvs001u01qm6lsmeold';
const TILESET_URL = 'mapbox://brad13martin.c1m5hzkh';
const SOURCE_LAYER = 'travelmap_geocoded-5lk8ms';

const DATA_SOURCE_ID = 'places';
const DATA_LAYER_ID  = 'places-points';

// show any JS error in-page so a blank screen isn't mysterious
window.addEventListener('error', e => showErr('JS error: ' + (e?.error?.message || e.message)));
function showErr(msg){ const el = document.getElementById('err'); el.style.display='block'; el.textContent = msg; }

// === Map init ===
const map = new mapboxgl.Map({
  container: 'map',
  style: STYLE_URL,
  center: [-80, 40],
  zoom: 5
});

map.addControl(new mapboxgl.NavigationControl());

// Directions UI (uses global mapboxgl accessToken)
const directions = new MapboxDirections({
  accessToken: mapboxgl.accessToken,
  profile: 'mapbox/driving',   // change to walking/cycling if you like
  unit: 'imperial',
  alternatives: true,
  controls: { instructions: false }
});
map.addControl(directions, 'top-right');

// surface Mapbox GL internal errors too
map.on('error', ev => showErr('Mapbox error: ' + (ev?.error?.message || JSON.stringify(ev))));

// === Data layer ===
map.on('load', () => {
  // add the vector tileset
  map.addSource(DATA_SOURCE_ID, { type: 'vector', url: TILESET_URL });

  // draw your points (simple, no styling logic yet)
  map.addLayer({
    id: DATA_LAYER_ID,
    type: 'circle',
    source: DATA_SOURCE_ID,
    'source-layer': SOURCE_LAYER,
    paint: {
      'circle-radius': 6,
      'circle-color': '#2563eb',
      'circle-stroke-color': '#fff',
      'circle-stroke-width': 1
    }
  });

  // popups
  map.on('click', DATA_LAYER_ID, e => {
    const p = e.features[0].properties || {};
    const ll = e.features[0].geometry.coordinates;
    const g = k => (p[k] ? String(p[k]) : '');
    const lines = [
      `<strong>${g('Name') || 'Place'}</strong>`,
      g('Type') && `<div><em>${g('Type')}</em></div>`,
      (g('City') || g('State')) && `${g('City')}${g('City')&&g('State')?', ':''}${g('State')}`,
      g('Notes') && `<div style="margin-top:6px">${g('Notes')}</div>`,
      g('URL') && `<div style="margin-top:6px"><a href="${g('URL')}" target="_blank" rel="noopener">Open link</a></div>`
    ].filter(Boolean);
    new mapboxgl.Popup().setLngLat(ll).setHTML(lines.join('<br>')).addTo(map);
  });

  map.on('mouseenter', DATA_LAYER_ID, () => map.getCanvas().style.cursor = 'pointer');
  map.on('mouseleave', DATA_LAYER_ID, () => map.getCanvas().style.cursor = '');
});
</script>
</body>
</html>
